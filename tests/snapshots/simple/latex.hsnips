global
const{autoFraction,inlineMathSuffix,math}=(exports=>{{function e(e){return e.backward?n(e):t(e)}function t(e){let{text:t,brackets:[n,r]}=e,{start:i,end:a}={start:0,end:t.length-1,...e};i<0&&(i+=t.length),a<0&&(a+=t.length);let o=i,s=0;for(;o+n.length-1<=a&&o+r.length-1<=a;){let e=t.slice(o,o+n.length);if(e===n){s++,o+=n.length;continue}if((n.length===r.length?e:t.slice(o,o+r.length))===r){if(s--,s===0)return o;o+=r.length;continue}o++}return-1}function n(e){let{text:t,brackets:[n,r]}=e,{start:i,end:a}={start:t.length-1,end:0,...e};i<0&&(i+=t.length),a<0&&(a+=t.length);let o=i+1,s=0;for(;o-n.length>=a&&o-r.length>=a;){let e=t.slice(o-r.length,o);if(e===r){s++,o-=r.length;continue}if((n.length===r.length?e:t.slice(o-n.length,o))===n){if(s--,o-=n.length,s===0)return o;continue}o--}return-1}const r=[[`(`,`)`],[`[`,`]`],[`{`,`}`]],i=new Map(r.map(([e,t])=>[e,[e,t]])),a=new Map(r.map(([e,t])=>[t,[e,t]]));function o(t){let n=t.length-1;for(;n>=0;n--){let r=t[n];if([`)`,`]`,`}`].includes(r)){let i=e({text:t,brackets:a.get(r),backward:!0,start:n});if(i!==-1){n=i;continue}}if([`(`,`[`,`{`].includes(r))break}let r=n+1;return t.slice(0,r)+`\\frac{`+t.slice(r)+`}`}function s(e){return e&&[`,`,`.`,`?`,`-`,` `].some(t=>e.startsWith(t))?``:` `}function c(e){return e.scopes.some(e=>!e.startsWith(`comment.line`)&&e.startsWith(`meta.math`))}exports.autoFraction=o,exports.inlineMathSuffix=s,exports.math=c;}return exports;})({});
endglobal

context !math(context)
snippet mk wA
$${1}$``
rv = inlineMathSuffix(t[1][0]);
``$2
endsnippet

context math(context)
snippet ali bA
\begin{aligned}
$1
\end{aligned}
endsnippet

context math(context)
snippet rm iA
\mathrm{$1}
endsnippet

context math(context)
snippet cal iA
\mathcal{$1}
endsnippet

context math(context)
snippet bf iA
\mathbf{$1}
endsnippet

context math(context)
snippet bb iA
\mathbb{$1}
endsnippet

context math(context)
snippet text iA
\text{$1}
endsnippet

context math(context)
snippet fd iA
_{$1}
endsnippet

context math(context)
snippet rd iA
^{$1}
endsnippet

context math(context)
snippet `(?<!\\)(alpha|beta|gamma|Gamma|delta|Delta|epsilon|varepsilon|zeta|eta|theta|vartheta|Theta|iota|kappa|lambda|Lambda|mu|nu|xi|omicron|pi|rho|varrho|sigma|Sigma|tau|upsilon|Upsilon|phi|varphi|Phi|chi|psi|omega|Omega)` "Greek characters" iA
\``rv = m[1]``
endsnippet

context math(context)
snippet `(?<!\\)(max|min|argmax|argmin|parallel|perp|partial|nabla|hbar|ell|infty|oplus|ominus|otimes|oslash|square|star|dagger|vee|wedge|subseteq|subset|supseteq|supset|emptyset|exists|nexists|forall|implies|impliedby|iff|setminus|neg|lor|land|bigcup|bigcap|cdot|times|simeq|approx|leq|geq|neq|gg|ll|equiv|sim|propto|rightarrow|leftarrow|Rightarrow|Leftarrow|leftrightarrow|to|mapsto|cap|cup|in|sum|prod|exp|ln|log|det|dots|vdots|ddots|pm|mp|int|iint|iiint|oint)` "Symbols" iA
\``rv = m[1]``
endsnippet

# context math(context)
# snippet `(.?)(pp|mm)` "plus" A
# ``
# const symbol = {
#     pp: '+',
#     mm: '-',
# }[m[2]];
# rv = m[1] === ' ' ? ` ${symbol} ` : m[1] === '$' ? `$${symbol}` : m[1] + ` ${symbol} `;
# ``
# endsnippet

context math(context)
snippet ` //` "fraction" iA
\frac{$1}{$2}$0
endsnippet

context math(context)
snippet `([^ /]+)/` "fraction" iA
``
rv = autoFraction(m[1]);
``{$1}$0
endsnippet


context !math(context)
snippet dm "display math" A
\begin{equation}
$1
\end{equation}
endsnippet
